<nb-layout>
  <nb-layout-column>
    <nb-card class="creative-card">
      <nb-card-header>
        <h2 class="title-header">ðŸ“‹ Course List</h2>
      </nb-card-header>

      <nb-card-body>
        <!-- ðŸ”Ž Barre de recherche + filtres -->
        <div class="filters-container">
          <input nbInput fullWidth placeholder="ðŸ” Search by title"
                [(ngModel)]="searchTerm" (input)="applyFilters()" />

          <!-- Filtre par Audience -->
          <nb-select placeholder="Filter by Audience"
                     [(selected)]="selectedAudience"
                     (selectedChange)="applyFilters()">
            <nb-option value="">All Audiences</nb-option>
            <nb-option value="STUDENTS">Students</nb-option>
            <nb-option value="TEACHERS">Teachers</nb-option>
            <nb-option value="PROFESSIONALS">Professionals</nb-option>
          </nb-select>

          <!-- Filtre par Niveau -->
          <nb-select placeholder="Filter by Level"
                     [(selected)]="selectedLevel"
                     (selectedChange)="applyFilters()">
            <nb-option value="">All Levels</nb-option>
            <nb-option value="BEGINNER">Beginner</nb-option>
            <nb-option value="INTERMEDIATE">Intermediate</nb-option>
            <nb-option value="ADVANCED">Advanced</nb-option>
          </nb-select>
        </div>

        <nb-spinner *ngIf="loading" status="primary"></nb-spinner>

        <table *ngIf="!loading && pagedCourses.length" class="training-table modern-table">
          <thead>
            <tr>
              <th>Fav</th>
              <th>Title</th>
              <th>Summary</th>
              <th>Audience</th>
              <th>Study Class</th>
              <th>Level</th>
              <th>Instructor</th>
              <th>Duration</th>
              <th>Language</th>
              <th>Location Type</th>
              <th>Actions</th>
              <th>Share</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let course of pagedCourses">

              <td class="fav-cell">
                <nb-icon [icon]="course.isFavorite ? 'star' : 'star-outline'" status="warning" class="favorite-icon"
                  (click)="toggleFavorite(course)"
                  [attr.title]="course.isFavorite ? 'Remove from favorites' : 'Add to favorites'">

                </nb-icon>
              </td>

              <td>{{ course.title }}</td>

              <!-- RÃ©sumÃ© avec toggle -->
              <td>
                <span *ngIf="course.summary">
                  <span *ngIf="!course.showFullSummary">
                    {{ course.summary | slice:0:40 }}
                    <span *ngIf="course.summary.length > 40">... </span>
                    <a href="#" *ngIf="course.summary.length > 40" (click)="toggleSummary(course, $event)">
                      <nb-icon icon="arrow-down-outline"></nb-icon>
                    </a>
                  </span>
                  <span *ngIf="course.showFullSummary">
                    {{ course.summary }}
                    <a href="#" (click)="toggleSummary(course, $event)">
                      <nb-icon icon="arrow-up-outline"></nb-icon>
                    </a>
                  </span>
                </span>
              </td>

              <td>{{ course.targetAudience }}</td>
              <td>{{ course.studyClass }}</td>
              <td>{{ course.level }}</td>
              <td>{{ course.instructor || 'N/A' }}</td>
              <td>{{ course.duration || 'N/A' }}</td>
              <td>{{ course.languages }}</td>
              <td>{{ course.locationType || 'N/A' }}</td>

              <!-- Actions -->
              <td class="action-cell">
                <div class="actions-column">
                  <button nbButton size="tiny" status="info" ghost (click)="editCourse(course.id)" title="Update">
                    <nb-icon icon="edit-outline"></nb-icon>
                  </button>
                  <button nbButton size="tiny" status="danger" ghost (click)="deleteCourse(course.id)" title="Delete">
                    <nb-icon icon="trash-2-outline"></nb-icon>
                  </button>
                </div>

                <div class="actions-column">
                  <button nbButton size="tiny" status="primary" ghost (click)="viewPresentation(course)"
                    [disabled]="course.loadingPresentation" title="View Presentation">
                    <nb-icon *ngIf="!course.loadingPresentation" icon="eye-outline"></nb-icon>
                    <div *ngIf="course.loadingPresentation" class="spinner">
                      <div class="blob blob-0"></div>
                      <div class="blob blob-1"></div>
                      <div class="blob blob-2"></div>
                      <div class="blob blob-3"></div>
                      <div class="blob blob-4"></div>
                      <div class="blob blob-5"></div>
                    </div>
                  </button>
                  <button nbButton size="tiny" status="warning" ghost (click)="regeneratePresentation(course)"
                    [disabled]="course.loadingPresentation" title="Regenerate New Presentation">
                    <nb-icon *ngIf="!course.loadingPresentation" icon="refresh-outline"></nb-icon>
                    <div *ngIf="course.loadingPresentation" class="spinner">
                      <div class="blob blob-0"></div>
                      <div class="blob blob-1"></div>
                      <div class="blob blob-2"></div>
                      <div class="blob blob-3"></div>
                      <div class="blob blob-4"></div>
                      <div class="blob blob-5"></div>
                    </div>
                  </button>
                </div>

                <div class="actions-column">
                  <!-- Satisfait -->
                  <button nbButton size="tiny" status="success" ghost
                          (click)="evaluateCourse(course.id, 3)"
                          [disabled]="course.userSatisfaction === 3"
                          title="Satisfied">
                    <nb-icon icon="smiling-face-outline"></nb-icon>
                  </button>

                  <!-- Non satisfait -->
                  <button nbButton size="tiny" status="danger" ghost
                          (click)="evaluateCourse(course.id, 1)"
                          [disabled]="course.userSatisfaction === 1"
                          title="Not Satisfied">
                    <nb-icon icon="alert-circle-outline"></nb-icon>
                  </button>


                </div>
              </td>

              <!-- Share -->
              <td class="share-cell">
                <button nbButton size="tiny" ghost [status]="course.publicPresentation ? 'success' : 'basic'"
                  (click)="togglePublic(course.id, !course.publicPresentation)" title="Share">
                  <nb-icon icon="share-outline"></nb-icon>
                </button>
              </td>

            </tr>
          </tbody>
        </table>

        <!-- Pagination -->
        <div class="pagination-controls" *ngIf="totalPages >= 1">
          <button nbButton size="tiny" ghost (click)="prevPage()" [disabled]="currentPage === 1">
            Â«
          </button>

          <ng-container *ngFor="let page of [].constructor(totalPages); let i = index">
            <button 
              nbButton 
              size="tiny" 
              [status]="currentPage === i+1 ? 'primary' : 'basic'" 
              (click)="goToPage(i+1)">
              {{ i + 1 }}
            </button>
          </ng-container>

          <button nbButton size="tiny" ghost (click)="nextPage()" [disabled]="currentPage === totalPages">
            Â»
          </button>
        </div>
        

        <p *ngIf="!loading && filteredCourses.length === 0">No courses found.</p>
      </nb-card-body>
    </nb-card>
  </nb-layout-column>
</nb-layout>