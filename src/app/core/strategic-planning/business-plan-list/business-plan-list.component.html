<nb-card>
  <nb-card-header>
    <div class="d-flex justify-content-between align-items-center">
      <span>All Strategy Created</span>
      <div class="d-flex gap-2">
        <input *ngIf="showSearchBar" type="text" nbInput placeholder="Search..." 
               [(ngModel)]="searchTerm" (input)="onSearch()" class="search-bar">
        
        <button nbButton size="tiny" status="basic" ghost (click)="toggleSearchBar()">
          <nb-icon icon="search-outline"></nb-icon>
        </button>
        
        <a *ngIf="!isAdmin" nbButton size="tiny" status="primary" ghost [routerLink]="'/strategic-planning'"
           nbTooltip="Create A Strategic-Planning" nbTooltipPlacement="bottom">
          <nb-icon icon="plus-outline"></nb-icon>
        </a>
      </div>
    </div>
  </nb-card-header>

  <nb-card-body>
    <table class="table nb-theme">
      <thead>
        <tr>
          <th>Title</th>
          <th>Creation Date</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
         <tr *ngFor="let plan of businessPlanDto">
          <td>{{ plan.title }}</td>
          <td>{{ plan.creationDate | date: 'longDate' }}</td> 
          <td class="d-flex gap-2">
           <button nbButton status="success" size="tiny" (click)="viewPresentation(plan)" ghost>
              <nb-icon icon="eye-outline" pack="eva"></nb-icon> 
            </button>

            <button *ngIf="!isAdmin" nbButton status="info" size="tiny" (click)="openDownloadOptions(plan)">
              <nb-icon icon="download-outline"></nb-icon>
            </button>

            <button *ngIf="!isAdmin" nbButton status="danger" size="tiny" (click)="openDeleteDialog(plan)">
              <nb-icon icon="trash-2-outline"></nb-icon>
            </button>
            
            <button *ngIf="!isAdmin" nbButton size="tiny" status="primary" ghost (click)="openEditDialog(plan)">
              <nb-icon icon="edit-outline"></nb-icon>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </nb-card-body>
</nb-card>

<!-- Presentation Dialog -->
<ng-template #presentationOptionsDialog let-ref="dialogRef">
  <nb-card>
    <nb-card-header>üëÅ Presentation of {{ currentPlan?.title }}</nb-card-header>
    <nb-card-body>
      <p>Choose how to view the plan:</p>
    </nb-card-body>
    <nb-card-footer class="d-flex justify-content-between">
      <button nbButton status="primary" (click)="handlePresentationChoice('generated'); ref.close()">Original version</button>
      <button nbButton status="success" (click)="handlePresentationChoice('edited'); ref.close()">Edited version</button>
      <button nbButton status="warning" (click)="handlePresentationChoice('regenerate'); ref.close()">Regenerate</button>
    </nb-card-footer>
  </nb-card>
</ng-template>

<!-- Download Dialog -->
<ng-template #downloadOptionsDialog let-ref="dialogRef">
  <nb-card>
    <nb-card-header>‚¨á Download {{ currentPlan?.title }}</nb-card-header>
    <nb-card-body>
      <p>Choose format:</p>
    </nb-card-body>
    <nb-card-footer class="d-flex justify-content-between">
      <button nbButton status="danger" (click)="handleDownloadChoice(currentPlan!, 'pdf'); ref.close()">PDF</button>
      <button nbButton status="info" (click)="handleDownloadChoice(currentPlan!, 'ppt'); ref.close()">PowerPoint</button>
    </nb-card-footer>
  </nb-card>
</ng-template>

<ng-template #deleteDialog let-data let-ref="dialogRef">
  <nb-card>
    <nb-card-header>Confirmation de suppression</nb-card-header>
    <nb-card-body>
      <p>Voulez-vous vraiment supprimer le business plan "{{ data.plan.title }}" ?</p>
    </nb-card-body>
    <nb-card-footer>
      <button nbButton status="danger" (click)="confirmDeleteAndClose(data.plan, ref)">Supprimer</button>
      <button nbButton status="basic" (click)="ref.close()">Annuler</button>
    </nb-card-footer>
  </nb-card>
</ng-template>


