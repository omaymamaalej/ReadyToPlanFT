<div class="background-shapes">
    <div class="shape shape-1"></div>
    <div class="shape shape-2"></div>
    <div class="shape shape-3"></div>
    <div class="shape shape-4"></div>
    <div class="shape shape-5"></div>
</div>

<div class="login-card">
    <div class="card-header">
        <div class="logo">
            <div class="logo-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                    <circle cx="9" cy="7" r="4"></circle>
                    <path d="M22 21v-2a4 4 0 0 0-3-3.87"></path>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                </svg>
            </div>
        </div>
        <h1 id="title" class="title">Login</h1>
        <p class="subtitle">Hello! Log in with your UserName.</p>
    </div>


    <nb-alert class="custom-alert" *ngIf="showMessages.error && errors?.length && !submitted" outline="danger"
        role="alert">
        <p class="alert-title"><b>Oh snap!</b></p>
        <ul class="alert-message-list">
            <li *ngFor="let error of errors" class="alert-message">{{ error }}</li>
        </ul>
    </nb-alert>

    <nb-alert *ngIf="showMessages.success && messages?.length && !submitted" outline="success" role="alert">
        <p class="alert-title"><b>Hooray!</b></p>
        <ul class="alert-message-list">
            <li *ngFor="let message of messages" class="alert-message">{{ message }}</li>
        </ul>
    </nb-alert>

    <form (ngSubmit)="login()" #form="ngForm" aria-labelledby="title" class="login-form">

        <div class="form-control-group">
            <label class="label" for="input-username">Username :</label>
            <input nbInput fullWidth [(ngModel)]="user.username" #username="ngModel" name="username" id="input-username"
                placeholder="Username" fieldSize="large" autofocus class="custom-input" [ngClass]="{
           'status-danger': (username.invalid && (username.dirty || username.touched)) || isLoginFailed,
           'status-success': username.valid && (username.dirty || username.touched) && !isLoginFailed
         }" [required]="getConfigValue('forms.validation.email.required')"
                [attr.aria-invalid]="username.invalid && username.touched ? true : null">
            <ng-container *ngIf="username.invalid && username.touched">
                <p class="caption status-danger" *ngIf="username.errors?.['required']">
                    Username is required!
                </p>
                <p class="caption status-danger" *ngIf="username.errors?.['incorrect']">
                    Invalid username or password
                </p>
            </ng-container>
        </div>

        <div class="form-control-group">
            <label class="label" for="input-password">Password :</label>
            <input nbInput fullWidth [(ngModel)]="user.password" #password="ngModel" name="password" type="password"
                id="input-password" placeholder="Password" fieldSize="large" class="custom-input" [ngClass]="{
           'status-danger': (password.invalid && (password.dirty || password.touched)) || isLoginFailed,
           'status-success': password.valid && (password.dirty || password.touched) && !isLoginFailed
         }" [required]="getConfigValue('forms.validation.password.required')"
                [minlength]="getConfigValue('forms.validation.password.minLength')"
                [maxlength]="getConfigValue('forms.validation.password.maxLength')"
                [attr.aria-invalid]="password.invalid && password.touched ? true : null">

            <!-- Messages d'erreur -->
            <ng-container *ngIf="password.invalid && password.touched">
                <p class="caption status-danger" *ngIf="password.errors?.['required']">
                    Password is required!
                </p>
                <p class="caption status-danger"
                    *ngIf="password.errors?.['minlength'] || password.errors?.['maxlength']">
                    Password should contain
                    from {{ getConfigValue('forms.validation.password.minLength') }}
                    to {{ getConfigValue('forms.validation.password.maxLength') }}
                    characters
                </p>
                <p class="caption status-danger" *ngIf="password.errors?.['incorrect']">
                    Invalid username or password
                </p>
            </ng-container>

            <!-- Toujours affichÃ© -->
            <div class="forgot-password-wrapper">
                <a class="forgot-password caption-2" routerLink="../request-password">Forgot Password ?</a>
            </div>
        </div>


        <div class="form-control-group accept-group">
            <nb-checkbox name="rememberMe" [(ngModel)]="user.rememberMe" *ngIf="rememberMe">Remember me</nb-checkbox>
        </div>

        <button class="login-btn" nbButton fullWidth status="primary" size="large" [disabled]="submitted || !form.valid"
            [class.btn-pulse]="submitted">
            Log In
        </button>
    </form>


    <section class="another-action" aria-label="Register">
        Don't have an account? <a class="text-link" routerLink="../register">Register</a>
    </section>


</div>