<nb-layout>
    <nb-layout-column>
        <nb-card class="creative-card">
            <nb-card-header>
                <h2 class="title-header">ðŸ‘¥ User List</h2>
            </nb-card-header>

            <nb-card-body>
                <nb-spinner *ngIf="loading" status="primary"></nb-spinner>

                <!-- ðŸ”Ž Barre de recherche + filtres -->
                <div class="filters-container">
                    <input nbInput placeholder="ðŸ” Search by name or email" [(ngModel)]="searchTerm"
                        (input)="applyFilters()" />

                    <nb-select placeholder="Filter by Status" [(selected)]="selectedStatus"
                        (selectedChange)="applyFilters()">
                        <nb-option value="">All</nb-option>
                        <nb-option value="activated">Activated</nb-option>
                        <nb-option value="deactivated">Deactivated</nb-option>
                    </nb-select>
                </div>

                <!-- Table des utilisateurs -->
                <table *ngIf="!loading && pagedUsers.length" class="modern-table">
                    <thead>
                        <tr>
                            <th>Login</th>
                            <th>Email</th>
                            <th>Profiles</th>
                            <th>Status</th>
                            <th>Created By</th>
                            <th>Created Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let user of pagedUsers">
                            <td>{{ user.login }}</td>
                            <td>{{ user.email }}</td>
                            <td>
                                <div *ngFor="let authority of user.authorities">
                                    <span class="badge">{{ authority }}</span>
                                </div>
                            </td>


                            <td>
                                <button nbButton size="tiny" [status]="user.activated ? 'success' : 'danger'"
                                    (click)="toggleStatus(user)">
                                    {{ user.activated ? 'Activated' : 'Deactivated' }}
                                </button>
                            </td>
                            <td>{{ user.createdBy }}</td>
                            <td>{{ user.createdDate ? (user.createdDate | date:'dd/MM/yy HH:mm') : 'N/A' }}</td>
                            <td class="action-cell">
                                <button nbButton size="tiny" status="info" ghost (click)="editUser(user)">
                                    <nb-icon icon="edit-outline"></nb-icon>
                                </button>
                                <button nbButton size="tiny" status="danger" ghost (click)="deleteUser(user)"
                                    [disabled]="user.login==='admin'">
                                    <nb-icon icon="trash-2-outline"></nb-icon>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <!-- Pagination -->
                <div class="pagination-controls" *ngIf="totalPages >= 1">
                    <button nbButton size="tiny" ghost (click)="prevPage()" [disabled]="currentPage === 1">
                        Â«
                    </button>

                    <ng-container *ngFor="let page of [].constructor(totalPages); let i = index">
                        <button 
                        nbButton 
                        size="tiny" 
                        [status]="currentPage === i+1 ? 'primary' : 'basic'" 
                        (click)="goToPage(i+1)">
                        {{ i + 1 }}
                        </button>
                    </ng-container>

                    <button nbButton size="tiny" ghost (click)="nextPage()" [disabled]="currentPage === totalPages">
                        Â»
                    </button>
                    </div>

                <p *ngIf="!loading && filteredUsers.length === 0">No users found.</p>
            </nb-card-body>
        </nb-card>
    </nb-layout-column>
</nb-layout>